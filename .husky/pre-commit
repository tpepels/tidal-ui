#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit quality checks..."

# Run linting
echo "ğŸ“ Running ESLint..."
if ! npm run lint; then
    echo "âŒ ESLint failed - fix linting errors before committing"
    exit 1
fi

# Run type checking
echo "ğŸ”§ Running TypeScript checks..."
if ! npm run check; then
    echo "âŒ TypeScript check failed - fix type errors before committing"
    exit 1
fi

# Run API endpoint validation (smart validation that distinguishes failure types)
echo "ğŸŒ Running API endpoint validation..."
if ! node scripts/validate-api-tests.cjs; then
    echo "âŒ API validation failed - review the output above"
    exit 1
fi

# Optional: Run API health check against real endpoints (non-blocking)
echo "ğŸ¥ Running API health check (optional)..."
if node scripts/check-api-health.cjs; then
    echo "âœ… API health check passed"
else
    echo "âš ï¸  API health check failed - this may indicate real API issues"
    echo "   Continuing with commit since tests are passing..."
fi

echo "ğŸ‰ All critical checks passed - safe to commit!"
echo "   âœ… Linting clean"
echo "   âœ… TypeScript valid"
echo "   âœ… API endpoints working"